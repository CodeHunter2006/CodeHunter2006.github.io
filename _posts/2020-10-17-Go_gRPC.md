---
layout: post
title: "gRPC"
date: 2020-10-17 22:20:00 +0800
tags: Go RPC
---

![gRPC](/assets/images/2020-10-17-Go_gRPC_1.png)
gRPC(Google Remote Procedure Call) 是 Google 开发的高性能、通用的开源 RPC 框架，其由 Google 主要面向移动应用开发并基于 HTTP/2 协议标准而设计，基于 Protobuf(Protocol Buffers)序列化协议开发，且支持众多开发语言。只需要定义请求和响应，然后 gRPC 会帮你处理一切剩余问题。

- 优点：
  - 速度快、执行效率高
  - 基于 HTTP/2 构建，低延迟
  - 支持流
  - 与开发语言无关，可以支持多种语言
  - 可以很简单的插入身份认证、负载均衡、日志、监控等功能

gRPC 是基于 protobuf 的，可参考这里：[protobuf](/2019/10/11/Go_Protobuf)

![gRPC](/assets/images/2020-10-17-Go_gRPC_2.png)

- gRPC 使用"合约优先"的 API 开发模式，它默认使用 Protocol Buffer(PB)作为接口设计语言(IDL)，这个`.proto`文件包括两部分内容：
  - 服务端和客户端之间传递的消息(各种结构体)
  - gRPC 服务的定义(提供哪些接口)

* 一个简单的 gRPC 示例

```proto3
syntax = "proto3";

package pb;

service Greeter {
    rpc SayHello (HelloRequest) returns (HelloReply);
}

message HelloRequest {
    string name = 1;
}

message HelloReply {
    string replyMessage = 1;
}
```

- 生成 grpc 代码
  `protoc --proto_path=. --go_out=plugins=grpc:. xxx/xxx/*.proto`

* 服务端调用代码

```Go
type greeterService struct{}
// 实现指定的接口
func (p *greeterService) SayHello (ctx context.Context, req *pb.HelloRequest) (*pb.HelloReply, error) {
    return &pb.HelloReply{ReplyMessage: proto.String("hello " + req.GetName())}, nil
}

func main() {
    listen, _ = net.Listen("TCP", ":10000")
    server = grpc.NewServer(grpc.WithInsecure())

    pb.RegisterGreeterServiceServer(server, new(greeterService))

    server.Serve(listen)
}
```

- 客户端调用代码

```Go

```

- 如果想通过 TLS 进行加密连接，可以通过私钥生成一个证书，用于 gRPC 通信
