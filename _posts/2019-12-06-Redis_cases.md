---
layout: post
title: "Redis使用记录"
date: 2019-12-06 22:00:00 +0800
tags: Redis
---

记录一些特殊的 Redis 应用场景

### Lua 脚本 VS SPOP

问题：
需要将一个集合中的数据一次性取出

方案 1:
`SPOP key [count]`
该命令在 redis3.2 之后提供，可以一次取出集合中的多个元素。

方案 2:
利用 lua 脚本，将元素取出并删除，实现原子操作。这样不用依赖 redis3.2 版本以上就可以实现。

- 使用 lua 脚本时要注意，如果要兼容 cordis，在同一个脚本中涉及的 key 要在一个分片上。

方案 3:
利用`SMEMBERS`将所有元素取出，然后用`SREM`一次性删除这些取出的元素，之后再开始对元素进行处理。虽然操作不是原子的，但是也符合取出后再处理的逻辑。
