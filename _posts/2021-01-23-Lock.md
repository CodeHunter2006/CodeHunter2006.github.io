---
layout: post
title: "Lock"
date: 2021-01-22 22:00:00 +0800
tags: Go
---

![Lock](/assets/images/2021-01-23-Lock_1.jpeg)
记录一些编程中锁相关的名词解释

## 为什么需要锁？

## 死锁

多个线程对不同资源加锁，进入并保持相互等待的状态。

### 发生条件

1. 加锁顺序不一致
2. 各自占有部分锁不释放

### 应对方案

针对上面发生的条件，只要打破条件就能避免死锁

- 所有线程获得资源时，保持一致的加锁顺序。这样前面资源未获得的也不会对后面资源加锁
- 一次获得所有资源的总锁，然后执行。简单粗暴，可以避免死锁，但并发性差
- 占有锁后，如果无法获得别的锁，则超时释放资源、稍后再试。类似乐观锁逻辑

### 分析方法

一般会有工具，可以列出发生死锁时的线程和资源锁状况，知道哪些线程获得了哪些锁、哪些线程在等待哪些锁，这样就可以画出一个依赖关系图。而关系图中出现了循环，说明发生了死锁。只要打破循环就能解锁。

## 常用锁结构

### Mutex(互斥锁)

### RWLock(读写锁)

### 分布式锁

## 使用模式

### 悲观锁

### 乐观锁

## 锁特性

### 可重入锁

## 数据库

### 范围

行锁、表锁、间隙锁、临键锁

### 操作目的

读锁、写锁、意向锁(意向读、意向写)
