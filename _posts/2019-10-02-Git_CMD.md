---
layout: post
title: "Git 常用命令"
date: 2019-10-02 18:10:00 +0800
tags: Git VCS
---

![Git](/assets/images/2019-10-02-Git_CMD_1.jpeg)
在这里记录常用 Git 操作。

# 配置项操作

`git config xxx`

`git config [--local] configName "configValue"` 默认将配置项记录在本项目的`./.git/config`文件中，只在当前项目起作用。

`git config --golobal configName "configValue"` 使用全局配置文件，在所有未设定的项目中起作用。

`git config --unset configName` 删除配置项。

## 记住密码

```
git config --global credential.helper store
```

在用户主目录的 `.gitconfig` 文件中生成下面的配置。

```
[credential]
	helper = store
```

如果没有`--global`，则在当前项目下的`.git/config`文件中添加。

## 设定 git 操作的账号

```
git config user.name "myUserName"
git config user.email "myUser@Email"
```

PS: 注意，如果不同项目针对的是不同的法律主体，一定不要搞错了，要及时更换默认的 global 设置。否则可能发生用前一家公司的账号向新公司提交的囧况。

# 常用命令

检出分支
`check out br`
当前工作目录的变更文件也会被带到新检出的目录

第一次推送分支到远程
`git push origin br`

merge 分支内容到当前工作目录
`git merge br`

rebase 分支内容到当前工作目录
`g`it rebase br`如果中间产生冲突，则需要解决冲突，然后`git rebase --continue`如果冲突并没有实际的文件，则只需要`git rebase --skip`

## add commit reset

`git add filepath`
添加某文件到 stage

`git add .`
添加所有变更到 stage

`git reset HEAD filepath`
从预备 stage 剔除某文件

`git commit -m "comments"`
将 stage 内容 commit

`git.exe reset --hard b6918745efad2fe4e5a41b65cfd0571e02410bd4`
强制回退当前 branch 的主线

## branch

`git branch br`
从当前工作目录创建分支，创建时并不会 checkout 到新 branch

`git checkout -b new_branch_name [remotes/origin/]old_branch`
创建 branch 并 checkout 到该 branch

`git branch -vv`
查看当前本地 branch 的信息，包括每个 branch 对应的远端 branch 名。

`git branch -a`
查看所有 branch 信息，远端 branch 名。

`git branch -D br`
删除本地分支或本地的 origin 分支

`git push origin :br (origin 后面有空格)`
删除远程分支

## revert

恢复某个被修改或删除的问题件
`git checkout xxx/xxx.xxx`

恢复某文件到某个历史版本
`git checkout d98a0f565804ba639ba46d6e4295d4f787ff2949 xxx/xxx.xxx`

`git revert commit_hash`
将特定一次 commit 代码回滚，再次提交时这个回滚的结果会作为新的一次 commit。

## tag

为某个版本建立一个快照并打上标签，用于基线控制。

`git tag -l ['v0.1.1.*']`
列出所有的 tag，可以增加模式匹配字符串。

`git checkout tagName`
checkout 出 tagName 对应的版本，并进入“detached HEAD" ，只读，无法进行更改。

`git checkout -b branchName tagName`
checkout 出 tagName 并创建为一个 branch，可以后续修改。

`git tag v1.1.1`
新建一个轻量级的(lightweight)tag，相当于给当前 commit 一个别名。

`git tag -a v1.1.1 -m 'this is an annoted tag names v1.1.1'`
新建一个带附注(annoted)的 tag，该 tag 对应的版本将形成一个独立的存储，并包含名字、邮箱号、日期、备注、校验等信息，允许使用 GPG(GNU Privacy Guard)来签署和验证。

`git show tagName`
显示 tag 相关信息

`git push origin tagName`
推送 tag 到远端

`git push origin --tags`
推送所有 tag 到远端

## diff

`--stat` 查看概要信息

```

```

`git diff`
查看当前 workspace 已经发生的变更

`git diff xxx/xxx`
查看具体文件在当前 workspace 下发生的变更

`git diff hash1 hash2 --stat`
查看两次 commit 的概要差异，这里的 hash1 hash2 只需要输入一部分就可以了

`git diff hash1 hash2 xxx1/xxx1.xx [xxx2/xxx2.xx]`
查看两次 commit 的某[些]文件的具体差异

`git diff hash1 hash2`
查看两次 commit 的所有文件的具体差异

上面命令的结果可以直接导出为`.patch`文件:

```
git diff hash1 hash2 * > test.patch
cat test.patch
```

生成的`.patch'文件可以在特定目录下导入差异:

```
patch < test.patch
```

`git diff branch1 branch2`
查看两个 branch 的差异，其他操作类似 hash

## change commit message

`git commit --amend -m "New commit message"`
修改最后一次提交的 message，如果已经 push 过，则再次 push 时需要加 -f。

# 示例场景

## 从 dev 创建 branch_my 进行开发，完毕后 merge 到 dev 然后提交

```
// 创建branch_my
git checkout -b branch_my dev	(如果已创建branch_my可以直接checkout)
// 进行编辑
git add ...
git commit ...
git stash (保存临时文件)
// 开始合并
git checkout dev
git pull --rebase
git checkout branch_my
git rebase dev
// 解决冲突
git checkout dev
git rebase branch_my
// 再次确保可以push
git pull --rebase
// push
git push
// 回到branch_my继续工作
git checkout branch_my
git stash pop
git checkout
```

## 从 dev 创建 my 进行开发，通过 MergeRequest 提交代码到 dev。

```
// 创建 my
git checkout -b my origin/dev
// 进行编辑
git add ...
git commit ...
// 合并
git fetch
git rebase origin/dev
// 解决了冲突后，可以push
git push origin my
// 之后可以提交MergeRequest
```

## 拷贝了不同 PC 上的 git 项目文件夹，缺少了 upsteam 信息

```
git branch --set-upstream-to=origin/branchName1 branchName2
```

通过上面语句可以补足上游信息，branchName 可以相同也可以不同。
