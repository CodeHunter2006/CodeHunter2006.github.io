---
layout: post
title: "MySQL 索引优化2"
date: 2020-04-14 23:00:00 +0800
tags: MySQL
---

## 复合索引用法

在 SQL 中索引的利用时机点顺序(从左到右)是`where ... group by ... having ... select ... order by`

在上面的依次匹配中，索引字段出现的顺序要符合**最佳左前缀**原则：

- 要从最左边的复合索引字段开始，依次使用
- 语句之间可以连续使用，例如`where a,b ... order by c,d`，这样也算是连续使用
- 不允许出现跨列，如果跨列则会完全不使用或者中断使用，例如：复合索引`a,b,c,d`，以`a,b,d,c`顺序使用时只用到`a,b`

其他优化点：

- SQL 优化器会把一些明显的问题自行修正，比如在`where`中你使用`b,c,a`，会被自动优化为`a,b,c`。但最好还是不要依赖优化器
- SQL 优化器会将前后 SQL 语句中的字段综合优化，例如`where a,d ... order by b,c`，会被优化为`a,b,c,d`，最终不会出现`using filesort`
- 多个复合索引之间，可能发生干扰，所以不用的复合索引要删掉
- where 中的 in 可能导致索引失效(发生跨列)，可以通过调整复合索引字段顺序以及 where 语句中字段顺序(将用到 in 的字段向后调整)，使得索引尽量可以多命中
- 与 in 同理， 与其等价的 or 也会导致索引失效
