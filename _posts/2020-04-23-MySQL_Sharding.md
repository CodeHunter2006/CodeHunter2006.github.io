---
layout: post
title: "MySQL Sharding"
date: 2020-04-25 23:00:00 +0800
tags: MySQL
---

为什么要分区分库分表？
通常 MySQL 的表支持到百万级时就开始产生性能问题，当达到千万级时就需要进行分去分库分表来提高性能。

# 引起性能下降的原因

- 数据量超过百万时，三层 B+树的索引已经开始出现性能下降，如果联表查询，性能会急剧下降
- InnoDB 在索引失效的情况下，行锁会退化为表锁，当数据量较大时，锁竞争的频率会越来越高，上下文切换会使性能急剧下降

# 分区

将一个表分解成多个区块进行操作和保存，从而降低每次操作的数据量，提高性能。对应用来说，分区是透明的，从逻辑上看只是一个表，在物理上这个表可能是由多个物理分区组成，每个分区是一个独立的文件，可以独立处理。

## 分区的功能

1. 进行逻辑数据分割，分割后的数据有多个不同的物理文件路径
2. 可以存储更多数据，突破系统单个文件最大限制
3. 提升性能，提高每个分区的读写速度，提高分区范围查询速度
4. 通过删除分区来快速删除数据
5. 可以跨多个磁盘来分散数据查询，从而提高磁盘 I/O 的性能
6. 涉及 SUM()、COUNT()这些聚合函数时，可以进行并行处理
7. 可以备份和恢复独立分区

## 可支持分区的引擎

MyISAM、InnoDB 都支持分区。同一个表的所有分区必须用同一种引擎。

- `show plugins;` 列表中显示`partition Active`表示支持分区

## 分区类型

1. RANGE 分区
   给予一个给定连续区间的列值，把多行分配给分区
2. LIST 分区
   每个分区按照指定的离散值进行分区
3. HASH 分区
   用用户指定的表达式产生非负 HASH 值选择分区
4. KEY 分区
   类似 HASH 分区，由 MySQL 提供 Hash 函数
